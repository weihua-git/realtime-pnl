# 📊 市场分析功能说明

## 🎯 功能概述

市场分析器直接调用**火币 API** 获取真实的历史 K线数据，提供专业的技术分析和开多/开空建议。

## 📡 数据来源

### 火币 K线 API

```javascript
// API 地址
https://api.hbdm.com/linear-swap-ex/market/history/kline

// 参数
contract_code: ETH-USDT  // 合约代码
period: 1min, 5min, 15min, 30min, 60min, 4hour, 1day  // K线周期
size: 200  // 获取条数
```

### 返回数据

每根 K线包含：
- `open`: 开盘价
- `high`: 最高价
- `low`: 最低价
- `close`: 收盘价
- `vol`: 成交量
- `id`: 时间戳

## 🔧 核心功能

### 1️⃣ 多时间窗口涨跌分析

分析不同时间段的价格变化：

```
📈 多时间窗口涨跌分析
───────────────────────────────────────────────────────
📈 30分钟     +0.80%  (2132.87 → 2150.00)
📈 1小时      +0.80%  (2132.87 → 2150.00)
📈 4小时      +0.81%  (2132.63 → 2150.00)
📈 24小时     +0.81%  (2132.63 → 2150.00)
📈 7天       +12.30%  (1915.00 → 2150.00)
📈 30天      +0.82%  (2132.60 → 2150.00)
```

**用途**：
- 快速判断短期、中期、长期趋势
- 对比不同时间段的表现
- 识别趋势转折点

---

### 2️⃣ 价格区间分析（高低点）

分析价格在各时间段的高低点和当前位置：

```
📊 价格区间分析（高低点）
───────────────────────────────────────────────────────

24小时:
  最高: 2266.29 (+5.41%)
  最低: 2066.16 (-3.90%)
  振幅: 9.69%
  当前位置: 42% [████████░░░░░░░░░░░░]
```

**用途**：
- 判断当前价格是否接近高点或低点
- 评估买入/卖出时机
- 计算潜在的盈亏空间

---

### 3️⃣ 波动率分析

分析市场波动程度：

```
📉 波动率分析
───────────────────────────────────────────────────────
🟢 1小时      平均: 0.10%  最大: 0.80%
🟡 24小时     平均: 0.60%  最大: 2.36%
🔴 7天        平均: 2.50%  最大: 8.50%
```

**用途**：
- 评估市场风险
- 决定仓位大小
- 选择合适的止损距离

---

### 4️⃣ 技术指标分析

计算专业的技术指标：

#### MA (移动平均线)
- MA20: 20 周期移动平均
- MA50: 50 周期移动平均
- 用途：判断趋势方向

#### RSI (相对强弱指标)
- 范围：0-100
- < 30: 超卖，可能反弹
- > 70: 超买，可能回调
- 30-70: 正常区间

#### MACD (指数平滑异同移动平均线)
- 金叉：看涨信号
- 死叉：看跌信号

#### 布林带 (Bollinger Bands)
- 上轨：阻力位
- 中轨：均线
- 下轨：支撑位
- 价格触及上轨：超买
- 价格触及下轨：超卖

---

### 5️⃣ 智能交易建议

基于多维度分析，给出开多/开空建议：

```
🤖 智能交易建议
───────────────────────────────────────────────────────
  🟢 建议操作: 做多 (买入开多)
  📊 信心指数: 75% ███████
  📈 看涨信号: 75 分
  📉 看跌信号: 15 分

  趋势分析:
    短期: 📈 上涨
    中期: 📈 上涨
    长期: 📈 上涨

  技术指标:
    MA20: 2241.35
    MA50: 2186.74
    RSI: 45.2 (正常)
    MACD: 看涨
    布林带: 上轨 2278.14 | 中轨 2241.35 | 下轨 2204.56

  分析依据:
    ✅ 短期和中期趋势向上
    ✅ 长期趋势向上
    ✅ 均线多头排列（价格 > MA20 > MA50）
    ✅ RSI 适中 (45.2)，有上涨空间
    ✅ MACD 看涨信号
    ✅ 价格接近24小时低点

  💡 操作建议:
    • 建议开多，止损设在近期低点下方
    • 建议仓位: 中等
    • 目标位: 观察上方阻力位
```

---

## 🎯 开多/开空判断逻辑

### 做多信号（看涨）

| 信号 | 权重 | 说明 |
|------|------|------|
| 多周期趋势向上 | 20-30 | 短期、中期、长期都上涨 |
| 均线多头排列 | 15 | 价格 > MA20 > MA50 |
| RSI 超卖反弹 | 15 | RSI < 30，可能反弹 |
| MACD 金叉 | 10 | MACD 看涨信号 |
| 触及布林带下轨 | 15 | 价格超卖，反弹机会 |
| 价格接近低点 | 10 | 接近 24h 低点 |
| 快速下跌后企稳 | 10 | 短期下跌后开始上涨 |

### 做空信号（看跌）

| 信号 | 权重 | 说明 |
|------|------|------|
| 多周期趋势向下 | 20-30 | 短期、中期、长期都下跌 |
| 均线空头排列 | 15 | 价格 < MA20 < MA50 |
| RSI 超买回调 | 15 | RSI > 70，可能回调 |
| MACD 死叉 | 10 | MACD 看跌信号 |
| 触及布林带上轨 | 15 | 价格超买，回调风险 |
| 价格接近高点 | 10 | 接近 24h 高点 |
| 快速上涨后滞涨 | 10 | 短期上涨后开始下跌 |

### 风险控制

| 情况 | 处理 |
|------|------|
| 波动率过高 | 降低信心指数 10 分 |
| 趋势不明确 | 降低信心指数 5 分 |
| 信心指数 < 40 | 建议观望 |

### 最终决策

```javascript
if (看涨信号 > 看跌信号) {
  action = 'long';  // 做多
  confidence = 看涨信号分数;
} else if (看跌信号 > 看涨信号) {
  action = 'short';  // 做空
  confidence = 看跌信号分数;
} else {
  action = 'hold';  // 观望
  confidence = 50;
}

if (confidence < 40) {
  action = 'hold';  // 信号不足，观望
}
```

---

## 💻 使用方法

### 1. 命令行测试

```bash
node test-analyzer.js
```

### 2. 代码集成

```javascript
import { MarketAnalyzer } from './market-analyzer.js';

const analyzer = new MarketAnalyzer();

// 生成分析报告
const report = await analyzer.generateReport('ETH-USDT', 2150, 2100);

// 打印报告
analyzer.printReport(report);

// 或单独使用各个功能
const multiTimeframe = await analyzer.analyzeMultiTimeframe('ETH-USDT', 2150);
const priceRange = await analyzer.analyzePriceRange('ETH-USDT', 2150);
const volatility = await analyzer.analyzeVolatility('ETH-USDT');
const suggestion = await analyzer.generateTradingSuggestion('ETH-USDT', 2150);
```

### 3. Web 界面集成

在 `web-server.js` 中添加 API：

```javascript
import { MarketAnalyzer } from './market-analyzer.js';

const analyzer = new MarketAnalyzer();

// 获取分析报告
app.get('/api/analysis/:symbol', async (req, res) => {
  const { symbol } = req.params;
  const { price, cost } = req.query;
  
  const report = await analyzer.generateReport(
    symbol,
    parseFloat(price),
    cost ? parseFloat(cost) : null
  );
  
  res.json(report);
});
```

---

## 📈 实际应用场景

### 场景 1：判断开仓时机

```
当前价格: 2150
24小时低点: 2066 (距离 -3.9%)
RSI: 28 (超卖)
趋势: 短期上涨

建议: 🟢 做多
理由: 价格接近低点且 RSI 超卖，反弹机会大
```

### 场景 2：判断平仓时机

```
当前价格: 2266
24小时高点: 2266 (距离 0%)
RSI: 75 (超买)
趋势: 短期滞涨

建议: 🔴 平多/做空
理由: 价格触及高点且 RSI 超买，回调风险大
```

### 场景 3：观望等待

```
当前价格: 2150
趋势: 短期上涨，中期下跌
RSI: 50 (正常)
信号: 多空均衡

建议: 🟡 观望
理由: 趋势不明确，等待更清晰的信号
```

---

## ⚠️ 注意事项

### 1. 数据延迟

- K线数据有 1 分钟缓存
- 实时价格需要从 WebSocket 获取

### 2. 信号准确性

- 技术分析不是 100% 准确
- 建议结合基本面分析
- 设置合理的止损

### 3. 风险控制

- 不要满仓操作
- 根据信心指数调整仓位
- 严格执行止损

### 4. 市场环境

- 震荡市场：降低仓位
- 趋势市场：可适当加仓
- 极端行情：停止交易

---

## 🔮 后续优化

### 短期
- [ ] 添加更多技术指标（KDJ、OBV 等）
- [ ] 支持自定义指标参数
- [ ] 添加回测功能

### 中期
- [ ] 机器学习预测
- [ ] 多币种对比分析
- [ ] 资金流向分析

### 长期
- [ ] 量化交易策略
- [ ] 自动下单功能
- [ ] 风险管理系统

---

**免责声明**：本工具仅供参考，不构成投资建议。交易有风险，投资需谨慎。
