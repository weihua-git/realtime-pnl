# 📝 Web 配置界面更新日志

## v3.2.0 - 2026-02-05

### 🚀 重大优化

#### K线 API 性能优化
- **成功率提升 700%**：从 12.5% 提升到 100%
- **请求次数减少 82.5%**：从 ~40 次减少到 7 次
- **分析速度提升 83%**：从 >30秒 优化到 ~5秒
- **缓存命中率 70%**：大幅减少 API 调用

#### 优化细节
- 修复 API 参数错误（`1hour` → `60min`）
- 增加缓存时间（60秒 → 5分钟）
- 实现请求限流（500ms 间隔）
- 指数退避重试策略（1s → 2s → 4s）
- 数据复用优化（避免重复请求）
- 增强错误处理（区分不同错误类型）

### 📚 文档更新
- 新增 `API优化说明.md` - 详细的优化方案和效果对比
- 更新 `问题修复说明.md` - 添加 K线 API 优化说明

---

## v3.1.0 - 2026-02-05

### ✨ 新增功能

#### 🌐 Web 配置界面
- 全新的 H5 响应式配置页面
- 支持手机、平板、电脑访问
- 可视化配置管理，无需编辑代码

#### ⚙️ 配置管理
- **价格目标监控**：设置价格达到/跌破目标时通知
- **监控合约列表**：勾选要监控的合约
- **多时间窗口监控**：配置不同时间窗口的价格变化阈值
- **持仓通知配置**：设置盈利/亏损/定时通知条件

#### 🔄 配置热重载
- 配置修改后 10 秒内自动生效
- 无需重启监控程序
- 实时日志输出配置变化

#### 📱 移动端支持
- iOS Safari：添加到主屏幕
- Android Chrome：添加到主屏幕
- 像原生 App 一样使用

### 🔧 技术改进

#### 架构优化
- 配置文件从硬编码改为 JSON 文件存储
- 新增 `ConfigManager` 类，支持配置热重载
- 监控程序自动监听配置变化

#### 新增文件
```
web/
├── index.html          # 主页面
├── css/style.css       # 样式文件
└── js/app.js           # Vue 应用

data/
└── config.json         # 配置文件

web-server.js           # Express 服务器
start-all.sh            # 一键启动脚本
test-web-config.js      # API 测试脚本
test-config.js          # 配置加载测试

docs/
├── Web配置指南.md      # 使用指南
├── 使用示例.md         # 实际场景
└── Web部署指南.md      # 部署指南
```

#### 修改文件
- `market-config.js`：改为配置管理器，支持热重载
- `realtime-pnl.js`：集成配置热重载功能
- `package.json`：添加 express 依赖和 web 启动脚本
- `README.md`：添加 Web 配置界面说明

### 📦 依赖更新
- 新增 `express@^4.18.2`

### 🚀 使用方式

#### 启动服务
```bash
# 方式一：分别启动
npm run web      # Web 配置界面
npm start        # 监控程序

# 方式二：一键启动
./start-all.sh
```

#### 访问配置页面
- 本地：http://localhost:3000
- 局域网：http://你的IP:3000

#### 修改配置
1. 打开配置页面
2. 修改配置项
3. 点击保存
4. 10 秒内自动生效

### 💡 使用场景

#### 场景 1：修改价格目标
- ETH-USDT 目标价 2200 → 2300
- 手机打开页面 → 修改 → 保存 → 自动生效

#### 场景 2：添加新合约
- 勾选 SOL-USDT
- 保存后自动订阅行情

#### 场景 3：调整通知阈值
- 盈利通知：3% → 5%
- 保存后立即应用新阈值

### 🔐 安全建议

- **局域网使用**：推荐只在局域网访问
- **公网访问**：需配置 Nginx + HTTPS + 认证
- **IP 白名单**：限制访问来源
- **定期备份**：备份 `data/config.json`

### 📊 后续计划

- [ ] 数据展示功能（持仓、盈亏、图表）
- [ ] 历史记录查询
- [ ] 配置导入/导出
- [ ] WebSocket 实时推送
- [ ] 多用户支持

### 🐛 已知问题

- 数据展示页面为占位页面，功能待开发
- 配置检查间隔固定为 10 秒，暂不可配置

### 📚 相关文档

- [WEB-README.md](WEB-README.md) - Web 功能总览
- [Web配置指南.md](docs/Web配置指南.md) - 详细使用指南
- [使用示例.md](docs/使用示例.md) - 实际使用场景
- [Web部署指南.md](docs/Web部署指南.md) - 服务器部署

---

## 升级指南

### 从 v3.0.0 升级到 v3.1.0

1. **拉取最新代码**
   ```bash
   git pull origin main
   ```

2. **安装新依赖**
   ```bash
   npm install
   ```

3. **迁移配置**
   
   旧配置在 `market-config.js` 中硬编码，新版本使用 `data/config.json`。
   
   首次启动时，程序会自动使用默认配置创建 `data/config.json`。
   
   如果需要保留旧配置，手动编辑 `data/config.json`。

4. **启动服务**
   ```bash
   # 启动 Web 配置界面
   npm run web
   
   # 启动监控程序（另一个终端）
   npm start
   ```

5. **验证功能**
   - 访问 http://localhost:3000
   - 修改配置并保存
   - 查看监控程序日志，确认配置已重载

### 兼容性说明

- ✅ 完全向后兼容
- ✅ 旧的 `market-config.js` 仍然可用（但推荐使用 Web 配置）
- ✅ 所有通知功能保持不变
- ✅ 监控逻辑保持不变

---

**简单、轻量、易用！** 🚀
