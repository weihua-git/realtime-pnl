# 量化交易使用指南

## 功能介绍

量化交易引擎是一个自动化交易系统，支持：

- ✅ **测试模式**：使用模拟资金测试策略，不会真实下单
- ✅ **实盘模式**：连接火币 API 进行真实交易
- ✅ **智能开仓**：基于技术指标（MA、RSI、MACD、布林带）自动判断做多/做空
- ✅ **风险控制**：止损、止盈、移动止损
- ✅ **多时间周期分析**：综合短期、中期、长期趋势
- ✅ **实时监控**：持仓盈亏、交易统计

## 快速开始

### 1. 配置 API 密钥

在 `.env` 文件中配置火币 API 密钥：

```bash
HTX_ACCESS_KEY=your_access_key
HTX_SECRET_KEY=your_secret_key
```

### 2. 启动交易（测试模式）

```bash
npm run trade
```

**默认是测试模式**，不会真实下单，只会模拟交易。

### 3. 切换到实盘模式

编辑 `start-trading.js`，修改配置：

```javascript
const config = {
  testMode: false, // 改为 false 启用实盘模式
  // ... 其他配置
};
```

⚠️ **警告**：实盘模式会使用真实资金交易，请谨慎操作！

## 配置参数说明

### 基础配置

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `testMode` | 测试模式开关 | `true` |
| `symbol` | 交易对 | `BTC-USDT` |
| `leverage` | 杠杆倍数 | `5` |
| `initialBalance` | 测试模式初始资金 | `1000 USDT` |

### 仓位管理

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `positionSize` | 每次开仓比例 | `0.1` (10%) |
| `maxPositions` | 最大同时持仓数 | `1` |

### 风险控制

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `stopLoss` | 止损比例 | `0.02` (2%) |
| `takeProfit` | 止盈比例 | `0.05` (5%) |
| `trailingStop` | 移动止损比例 | `0.03` (3%) |

### 运行参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `checkInterval` | 检查间隔（毫秒） | `10000` (10秒) |

## 交易策略说明

### 开仓条件

系统会综合以下技术指标判断开仓信号：

#### 做多信号（看涨）
- ✅ 短期和中期趋势向上
- ✅ 价格在移动平均线之上（多头排列）
- ✅ RSI 超卖反弹（< 30）
- ✅ MACD 金叉
- ✅ 价格触及布林带下轨
- ✅ 价格接近区间低点

#### 做空信号（看跌）
- ❌ 短期和中期趋势向下
- ❌ 价格在移动平均线之下（空头排列）
- ❌ RSI 超买回调（> 70）
- ❌ MACD 死叉
- ❌ 价格触及布林带上轨
- ❌ 价格接近区间高点

**信心指数**：系统会计算信号强度（0-100），只有信心指数 > 60 才会开仓。

### 平仓条件

#### 1. 止损
- 亏损达到设定比例（默认 2%）时自动平仓

#### 2. 止盈
- 盈利达到设定比例（默认 5%）时自动平仓

#### 3. 移动止损
- 做多：价格从最高点回撤 3% 时平仓
- 做空：价格从最低点反弹 3% 时平仓

## 使用示例

### 示例 1：保守策略（小仓位，严格止损）

```javascript
const config = {
  testMode: true,
  symbol: 'BTC-USDT',
  leverage: 3, // 低杠杆
  initialBalance: 1000,
  positionSize: 0.05, // 5% 仓位
  stopLoss: 0.015, // 1.5% 止损
  takeProfit: 0.03, // 3% 止盈
  trailingStop: 0.02, // 2% 移动止损
  checkInterval: 30000, // 30秒检查一次
};
```

### 示例 2：激进策略（大仓位，高收益）

```javascript
const config = {
  testMode: true,
  symbol: 'ETH-USDT',
  leverage: 10, // 高杠杆
  initialBalance: 1000,
  positionSize: 0.2, // 20% 仓位
  stopLoss: 0.03, // 3% 止损
  takeProfit: 0.08, // 8% 止盈
  trailingStop: 0.05, // 5% 移动止损
  checkInterval: 5000, // 5秒检查一次
};
```

### 示例 3：多持仓策略

```javascript
const config = {
  testMode: true,
  symbol: 'BTC-USDT',
  leverage: 5,
  initialBalance: 5000,
  positionSize: 0.1, // 每次 10%
  maxPositions: 3, // 最多 3 个持仓
  stopLoss: 0.02,
  takeProfit: 0.05,
  trailingStop: 0.03,
  checkInterval: 10000,
};
```

## 运行界面说明

### 启动信息
```
═══════════════════════════════════════════════════════
🚀 量化交易引擎启动
═══════════════════════════════════════════════════════
📊 交易对: BTC-USDT
🔧 模式: 测试模式 (模拟交易)
💰 初始资金: 1000.00 USDT
📈 杠杆倍数: 5x
📊 仓位大小: 10%
🛡️ 止损: 2%
🎯 止盈: 5%
📉 移动止损: 3%
═══════════════════════════════════════════════════════
```

### 实时状态
```
[2026-02-06 10:30:00] 📊 交易状态
💰 余额: 1050.23 USDT
💵 当前价格: 45230.50 USDT
📈 持仓数: 1/1

持仓详情:
  1. 🟢 LONG 0.0011 @ 45000.00 | 盈亏: 0.51%

📊 统计数据:
  总交易: 5 | 胜: 3 | 负: 2
  胜率: 60.00%
  总盈亏: 50.23 USDT (5.02%)
  最大回撤: 1.23%
```

### 交易信号
```
📈 检测到做多信号 (信心: 75%)
✅ 模拟开仓成功: LONG 0.0011 @ 45000.00
```

### 平仓信号
```
🎯 触发止盈: LONG @ 47250.00 (盈利 5.00%)
✅ 模拟平仓成功: LONG @ 47250.00 | 盈亏: 24.75 USDT (5.00%)
```

## 注意事项

### ⚠️ 风险提示

1. **测试先行**：务必先在测试模式下运行，验证策略有效性
2. **小额试水**：首次实盘建议使用小额资金
3. **监控运行**：定期检查程序运行状态
4. **网络稳定**：确保网络连接稳定，避免错过平仓信号
5. **API 限制**：注意火币 API 调用频率限制

### 💡 优化建议

1. **调整参数**：根据市场波动调整止损止盈比例
2. **选择时机**：避免在重大新闻发布时运行
3. **分散风险**：不要把所有资金投入单一交易对
4. **定期回测**：使用历史数据测试策略表现
5. **记录日志**：保存交易记录，分析改进策略

## 常见问题

### Q1: 如何停止交易？
按 `Ctrl + C` 停止程序，系统会自动生成交易总结报告。

### Q2: 测试模式和实盘模式有什么区别？
- **测试模式**：使用模拟资金，不会真实下单，用于验证策略
- **实盘模式**：连接火币 API，使用真实资金交易

### Q3: 如何查看历史交易记录？
程序会在内存中记录所有订单，停止时会打印总结报告。后续可以添加数据库存储功能。

### Q4: 可以同时运行多个交易对吗？
目前每个实例只支持一个交易对，可以启动多个进程交易不同的币种。

### Q5: 信心指数是如何计算的？
系统综合多个技术指标（MA、RSI、MACD、布林带、趋势）计算信号强度，范围 0-100。

### Q6: 为什么没有开仓？
可能原因：
- 信心指数 < 60（信号不够强）
- 已达到最大持仓数
- 市场趋势不明确

### Q7: 如何调整策略更激进/保守？
- **更激进**：提高杠杆、增加仓位、放宽止损
- **更保守**：降低杠杆、减少仓位、收紧止损

## 下一步计划

- [ ] 添加数据库存储交易记录
- [ ] 支持多交易对同时运行
- [ ] 添加更多技术指标（KDJ、SAR 等）
- [ ] 支持自定义策略脚本
- [ ] Web 界面实时监控
- [ ] 回测功能（使用历史数据）
- [ ] 风险预警通知

## 技术支持

如有问题，请查看：
- [快速开始](./快速开始.md)
- [常见问题解答](./常见问题解答.md)
- [API 优化说明](./API优化说明.md)
