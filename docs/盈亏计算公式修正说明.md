# ç›ˆäºè®¡ç®—å…¬å¼ä¿®æ­£è¯´æ˜

## ğŸ“‹ é—®é¢˜å‘ç°

ç”¨æˆ·æŒ‡å‡ºç›ˆäºè®¡ç®—å…¬å¼å¯èƒ½æœ‰è¯¯ï¼Œå¹¶æä¾›äº†ç«å¸å®˜æ–¹æ–‡æ¡£é“¾æ¥ï¼š
https://www.htx.com/zh-cn/support/900003178763/

## ğŸ” é—®é¢˜åˆ†æ

### åŸä»£ç ä½¿ç”¨çš„å…¬å¼ï¼ˆæ–¹æ³•2ï¼‰ï¼š
```javascript
const profitUSDT = priceChangePercent * value * this.config.leverage;
```

### ç«å¸å®˜æ–¹å…¬å¼ï¼ˆæ–¹æ³•1ï¼‰ï¼š
```
ç›ˆäº(USDT) = (å¹³ä»“ä»· - å¼€ä»“ä»·) Ã— åˆçº¦å¼ æ•° Ã— åˆçº¦é¢å€¼
```

## âœ… éªŒè¯ç»“æœ

é€šè¿‡æµ‹è¯•éªŒè¯ï¼ˆè§ `test-formula-comparison.js`ï¼‰ï¼Œå‘ç°ï¼š

**ä¸¤ç§æ–¹æ³•åœ¨æ•°å­¦ä¸Šå®Œå…¨ç­‰ä»·ï¼**

### æ•°å­¦è¯æ˜ï¼š

```
å¼ æ•° = (ä¿è¯é‡‘ Ã— æ æ†) / (å¼€ä»“ä»· Ã— åˆçº¦é¢å€¼)

ç›ˆäº = (å¹³ä»“ä»· - å¼€ä»“ä»·) Ã— å¼ æ•° Ã— åˆçº¦é¢å€¼
    = (å¹³ä»“ä»· - å¼€ä»“ä»·) Ã— [(ä¿è¯é‡‘ Ã— æ æ†) / (å¼€ä»“ä»· Ã— åˆçº¦é¢å€¼)] Ã— åˆçº¦é¢å€¼
    = (å¹³ä»“ä»· - å¼€ä»“ä»·) / å¼€ä»“ä»· Ã— ä¿è¯é‡‘ Ã— æ æ†
    = ä»·æ ¼å˜åŒ–% Ã— ä¿è¯é‡‘ Ã— æ æ†
```

### æµ‹è¯•ç»“æœï¼š

| åœºæ™¯ | æ–¹æ³•1ç»“æœ | æ–¹æ³•2ç»“æœ | å·®å¼‚ |
|------|----------|----------|------|
| åšå¤šBTC +5% | 50.0000 USDT | 50.0000 USDT | 0.00000000 |
| åšç©ºBTC -3% | 30.0000 USDT | 30.0000 USDT | 0.00000000 |
| åšå¤šETH +10% | 100.0000 USDT | 100.0000 USDT | 0.00000000 |
| åšç©ºBTC +2% | -24.0000 USDT | -24.0000 USDT | 0.00000000 |

## ğŸ”§ ä¿®æ”¹å†³ç­–

è™½ç„¶ä¸¤ç§æ–¹æ³•ç­‰ä»·ï¼Œä½†é€‰æ‹©**æ–¹æ³•1ï¼ˆå®˜æ–¹å…¬å¼ï¼‰**ï¼ŒåŸå› ï¼š

1. âœ… **ä¸å®˜æ–¹æ–‡æ¡£è¡¨è¿°ä¸€è‡´**ï¼šæ›´å®¹æ˜“å¯¹ç…§å®¡è®¡
2. âœ… **æ›´ç›´è§‚æ˜“æ‡‚**ï¼šç›´æ¥çœ‹åˆ°å¼ æ•°å’Œä»·æ ¼å·®
3. âœ… **ä¾¿äºè°ƒè¯•éªŒè¯**ï¼šå¯ä»¥æ£€æŸ¥æ¯ä¸ªä¸­é—´å€¼
4. âœ… **é¿å…æ¦‚å¿µæ··æ·†**ï¼šæ˜ç¡®æ˜¾ç¤ºç›ˆäºè®¡ç®—è¿‡ç¨‹

## ğŸ“ ä¿®æ”¹å†…å®¹

### 1. `verifyPositionsOnStartup()` æ–¹æ³•
```javascript
// ä¿®æ”¹å‰
const profitUSDT = priceChangePercent * value * this.config.leverage;
const margin = value / this.config.leverage;

// ä¿®æ”¹å
const contractSize = this.getContractSize(this.config.symbol);
let profitUSDT;
if (direction === 'long') {
  profitUSDT = (currentPrice - entryPrice) * position.size * contractSize;
} else {
  profitUSDT = (entryPrice - currentPrice) * position.size * contractSize;
}
const margin = value;
```

### 2. `checkPositions()` æ–¹æ³•
```javascript
// ä¿®æ”¹å‰
const profitUSDT = priceChangePercent * positionValue * this.config.leverage;
const margin = positionValue / this.config.leverage;

// ä¿®æ”¹å
const contractSize = this.getContractSize(this.config.symbol);
let profitUSDT;
if (direction === 'long') {
  profitUSDT = (currentPrice - entryPrice) * size * contractSize;
} else {
  profitUSDT = (entryPrice - currentPrice) * size * contractSize;
}
const margin = value;
```

### 3. `closePosition()` æ–¹æ³•
```javascript
// ä¿®æ”¹å‰
const profitBeforeFee = priceChangePercent * value * this.config.leverage;
const actualTradeValue = value * this.config.leverage;
const margin = value / this.config.leverage;

// ä¿®æ”¹å
const contractSize = this.getContractSize(this.config.symbol);
let profitBeforeFee;
if (direction === 'long') {
  profitBeforeFee = (price - entryPrice) * size * contractSize;
} else {
  profitBeforeFee = (entryPrice - price) * size * contractSize;
}
const actualTradeValue = size * contractSize * price;
const margin = value;
```

### 4. `getStatus()` æ–¹æ³•
```javascript
// ä¿®æ”¹å‰
const profitUSDT = priceChangePercent * pos.value * this.config.leverage;
const margin = pos.value / this.config.leverage;

// ä¿®æ”¹å
const contractSize = this.getContractSize(this.config.symbol);
let profitUSDT;
if (pos.direction === 'long') {
  profitUSDT = (this.lastPrice - pos.entryPrice) * pos.size * contractSize;
} else {
  profitUSDT = (pos.entryPrice - this.lastPrice) * pos.size * contractSize;
}
const margin = pos.value;
```

### 5. `printStatus()` æ–¹æ³•
```javascript
// ä¿®æ”¹å‰
const profitUSDT = priceChangePercent * pos.value * this.config.leverage;
const margin = pos.value / this.config.leverage;

// ä¿®æ”¹å
const contractSize = this.getContractSize(this.config.symbol);
let profitUSDT;
if (pos.direction === 'long') {
  profitUSDT = (this.lastPrice - pos.entryPrice) * pos.size * contractSize;
} else {
  profitUSDT = (pos.entryPrice - this.lastPrice) * pos.size * contractSize;
}
const margin = pos.value;
```

### 6. æ‰‹ç»­è´¹è®¡ç®—ä¿®æ­£
```javascript
// ä¿®æ”¹å‰ï¼ˆå¼€ä»“ï¼‰
const actualTradeValue = positionValue * this.config.leverage;
const openFee = actualTradeValue * this.config.takerFee;

// ä¿®æ”¹åï¼ˆå¼€ä»“ï¼‰
const actualTradeValue = roundedSize * contractSize * price;
const openFee = actualTradeValue * this.config.takerFee;

// ä¿®æ”¹åï¼ˆå¹³ä»“ï¼‰
const actualTradeValue = size * contractSize * price;
const closeFee = actualTradeValue * this.config.takerFee;
```

## ğŸ¯ å…³é”®å˜åŒ–

1. **ä¿è¯é‡‘å®šä¹‰**ï¼š`value` æœ¬èº«å°±æ˜¯ä¿è¯é‡‘ï¼Œä¸éœ€è¦é™¤ä»¥æ æ†
2. **ç›ˆäºè®¡ç®—**ï¼šä½¿ç”¨å®˜æ–¹å…¬å¼ï¼Œç›´æ¥è®¡ç®—ä»·æ ¼å·® Ã— å¼ æ•° Ã— é¢å€¼
3. **æ‰‹ç»­è´¹è®¡ç®—**ï¼šåŸºäºå®é™…æˆäº¤é‡‘é¢ï¼ˆå¼ æ•° Ã— é¢å€¼ Ã— ä»·æ ¼ï¼‰

## âœ… éªŒè¯æ–¹æ³•

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯ï¼š
```bash
node test-formula-comparison.js
```

## ğŸ“š å‚è€ƒæ–‡æ¡£

- ç«å¸å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.htx.com/zh-cn/support/900003178763/
- æµ‹è¯•è„šæœ¬ï¼š`test-profit-calculation.js`
- å¯¹æ¯”æµ‹è¯•ï¼š`test-formula-comparison.js`

## ğŸ‰ ç»“è®º

è™½ç„¶åŸå…¬å¼åœ¨æ•°å­¦ä¸Šæ˜¯æ­£ç¡®çš„ï¼Œä½†ä¿®æ”¹ä¸ºå®˜æ–¹å…¬å¼åï¼š
- âœ… æ›´ç¬¦åˆç«å¸å®˜æ–¹æ–‡æ¡£è¡¨è¿°
- âœ… ä»£ç æ›´æ˜“ç†è§£å’Œå®¡è®¡
- âœ… è®¡ç®—ç»“æœå®Œå…¨ä¸€è‡´
- âœ… é¿å…æ¦‚å¿µæ··æ·†

**ä¿®æ”¹å®Œæˆï¼Œå¯ä»¥ç»§ç»­æµ‹è¯•ï¼**

