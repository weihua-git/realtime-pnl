<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>HTX ç›‘æ§é…ç½®</title>
  <style>
    /* é˜²æ­¢ Vue æœªåŠ è½½æ—¶æ˜¾ç¤ºæ¨¡æ¿è¯­æ³• */
    [v-cloak] {
      display: none !important;
    }
    
    /* åŠ è½½åŠ¨ç”» */
    .app-loading {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .app-loading .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    .app-loading .loading-text {
      color: white;
      margin-top: 20px;
      font-size: 16px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Vue åŠ è½½å®Œæˆåéšè—åŠ è½½åŠ¨ç”» */
    [v-cloak] + .app-loading {
      display: none;
    }
  </style>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- åŠ è½½åŠ¨ç”» -->
  <div class="app-loading">
    <div class="spinner"></div>
    <div class="loading-text">åŠ è½½ä¸­...</div>
  </div>
  
  <div id="app" v-cloak>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="header">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h1>ğŸ“Š HTX ç›‘æ§é…ç½®</h1>
        <div class="ws-status" :class="{ connected: wsConnected, disconnected: !wsConnected }">
          <span class="status-dot"></span>
          <span class="status-text">{{ wsConnected ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}</span>
        </div>
      </div>
      <div class="tabs">
        <button 
          class="tab-btn" 
          :class="{ active: currentTab === 'config' }"
          @click="currentTab = 'config'">
          âš™ï¸ é…ç½®ç®¡ç†
        </button>
        <button 
          class="tab-btn" 
          :class="{ active: currentTab === 'analysis' }"
          @click="currentTab = 'analysis'">
          ğŸ“Š å¸‚åœºåˆ†æ
        </button>
        <button 
          class="tab-btn" 
          :class="{ active: currentTab === 'calculator' }"
          @click="currentTab = 'calculator'">
          ğŸ§® æ­¢ç›ˆæ­¢æŸè®¡ç®—å™¨
        </button>
        <button 
          class="tab-btn" 
          :class="{ active: currentTab === 'data' }"
          @click="currentTab = 'data'">
          ğŸ“ˆ æ•°æ®å±•ç¤º
        </button>
      </div>
    </header>

    <!-- é…ç½®ç®¡ç†é¡µé¢ -->
    <div v-show="currentTab === 'config'" class="container">
      
      <!-- ä»·æ ¼ç›®æ ‡ç›‘æ§ -->
      <section class="card">
        <div class="card-header">
          <h2>ğŸ¯ ä»·æ ¼ç›®æ ‡ç›‘æ§</h2>
          <label class="switch">
            <input type="checkbox" v-model="config.priceTargets.enabled">
            <span class="slider"></span>
          </label>
        </div>
        
        <div v-if="config.priceTargets.enabled" class="card-body">
          <div v-for="(target, index) in config.priceTargets.targets" :key="index" class="target-item">
            <div class="target-row">
              <select v-model="target.symbol" class="input">
                <option value="ETH-USDT">ETH-USDT</option>
                <option value="BTC-USDT">BTC-USDT</option>
                <option value="SOL-USDT">SOL-USDT</option>
                <option value="DOGE-USDT">DOGE-USDT</option>
                <option value="XRP-USDT">XRP-USDT</option>
              </select>
              
              <input 
                type="number" 
                v-model.number="target.targetPrice" 
                placeholder="ç›®æ ‡ä»·æ ¼"
                class="input"
                step="0.01">
              
              <select v-model="target.direction" class="input">
                <option value="above">è¾¾åˆ° â‰¥</option>
                <option value="below">è·Œç ´ â‰¤</option>
              </select>
              
              <button @click="removeTarget(index)" class="btn-delete">ğŸ—‘ï¸</button>
            </div>
            
            <!-- é«˜çº§é€‰é¡¹ -->
            <div class="target-advanced">
              <label class="checkbox-label">
                <input type="checkbox" v-model="target.notifyOnce">
                <span>åªé€šçŸ¥ä¸€æ¬¡ï¼ˆè§¦å‘åè‡ªåŠ¨ç§»é™¤ï¼‰</span>
              </label>
              
              <div v-if="!target.notifyOnce" class="sub-inputs">
                <div class="input-group">
                  <label>é€šçŸ¥é—´éš” (ç§’)</label>
                  <input 
                    type="number" 
                    v-model.number="target.notifyInterval" 
                    class="input-small"
                    min="0"
                    step="1"
                    placeholder="60">
                  <small class="input-hint">0 = æ¯æ¬¡éƒ½é€šçŸ¥ï¼ˆä¸æ¨èï¼‰</small>
                </div>
              </div>
              
              <div class="input-group">
                <label>ä»·æ ¼å¹…åº¦ (%)</label>
                <input 
                  type="number" 
                  v-model.number="target.rangePercent" 
                  class="input-small"
                  min="0"
                  max="100"
                  step="0.1"
                  placeholder="0">
                <small class="input-hint" v-if="target.rangePercent > 0 && target.direction === 'above'">
                  é€šçŸ¥èŒƒå›´: {{ target.targetPrice.toFixed(2) }} ~ {{ (target.targetPrice * (1 + target.rangePercent / 100)).toFixed(2) }} (è¶…å‡ºæ­¤èŒƒå›´åœæ­¢é€šçŸ¥)
                </small>
                <small class="input-hint" v-else-if="target.rangePercent > 0 && target.direction === 'below'">
                  é€šçŸ¥èŒƒå›´: {{ (target.targetPrice * (1 - target.rangePercent / 100)).toFixed(2) }} ~ {{ target.targetPrice.toFixed(2) }} (è¶…å‡ºæ­¤èŒƒå›´åœæ­¢é€šçŸ¥)
                </small>
                <small class="input-hint" v-else>
                  0 = æ— å¹…åº¦é™åˆ¶ï¼ŒæŒç»­é€šçŸ¥
                </small>
              </div>
            </div>
          </div>
          
          <button @click="addTarget" class="btn-add">â• æ·»åŠ ç›®æ ‡</button>
        </div>
      </section>

      <!-- ç›‘æ§åˆçº¦åˆ—è¡¨ -->
      <section class="card">
        <div class="card-header">
          <h2>ğŸ“‹ ç›‘æ§åˆçº¦åˆ—è¡¨</h2>
        </div>
        <div class="card-body">
          <div class="contract-list">
            <label v-for="contract in availableContracts" :key="contract" class="checkbox-label">
              <input 
                type="checkbox" 
                :value="contract"
                :checked="config.watchContracts.includes(contract)"
                @change="toggleContract(contract)">
              <span>{{ contract }}</span>
            </label>
          </div>
        </div>
      </section>

      <!-- å¤šæ—¶é—´çª—å£ç›‘æ§ -->
      <section class="card">
        <div class="card-header">
          <h2>â±ï¸ å¤šæ—¶é—´çª—å£ç›‘æ§</h2>
          <label class="switch">
            <input type="checkbox" v-model="config.priceChangeConfig.enabled">
            <span class="slider"></span>
          </label>
        </div>
        
        <div v-if="config.priceChangeConfig.enabled" class="card-body">
          <div class="info-box">
            <p>ğŸ“Š ç›‘æ§ä»·æ ¼åœ¨ä¸åŒæ—¶é—´çª—å£çš„å˜åŒ–å¹…åº¦</p>
          </div>
          
          <div v-for="(window, index) in config.priceChangeConfig.timeWindows" :key="index" class="window-item">
            <div class="window-label">{{ window.name }}</div>
            <div class="window-inputs">
              <div class="input-group">
                <label>å˜åŒ–å¹…åº¦ (%)</label>
                <input 
                  type="number" 
                  v-model.number="window.threshold" 
                  step="0.1"
                  class="input-small">
              </div>
              <div class="input-group">
                <label>å˜åŒ–é‡‘é¢ (USDT)</label>
                <input 
                  type="number" 
                  v-model.number="window.amountThreshold" 
                  step="0.1"
                  class="input-small">
              </div>
            </div>
          </div>
          
          <div class="input-group">
            <label>é€šçŸ¥é—´éš” (åˆ†é’Ÿ)</label>
            <input 
              type="number" 
              v-model.number="minNotifyIntervalMinutes" 
              class="input"
              min="1">
          </div>
        </div>
      </section>

      <!-- æŒä»“é€šçŸ¥é…ç½® -->
      <section class="card">
        <div class="card-header">
          <h2>ğŸ”” æŒä»“é€šçŸ¥é…ç½®</h2>
        </div>
        <div class="card-body">
          <div class="notification-grid">
            <div class="notification-item">
              <label class="checkbox-label">
                <input type="checkbox" v-model="config.notificationConfig.enableProfitNotification">
                <span>ç›ˆåˆ©é€šçŸ¥</span>
              </label>
              <div v-if="config.notificationConfig.enableProfitNotification" class="sub-inputs">
                <div class="input-group">
                  <label>ç›ˆåˆ©æ¯”ä¾‹ (%)</label>
                  <input 
                    type="number" 
                    v-model.number="config.notificationConfig.profitThreshold" 
                    class="input-small"
                    step="0.1">
                </div>
                <div class="input-group">
                  <label>ç›ˆåˆ©é‡‘é¢ (USDT)</label>
                  <input 
                    type="number" 
                    v-model.number="config.notificationConfig.profitAmountThreshold" 
                    class="input-small"
                    step="0.1">
                </div>
              </div>
            </div>

            <div class="notification-item">
              <label class="checkbox-label">
                <input type="checkbox" v-model="config.notificationConfig.enableLossNotification">
                <span>äºæŸé€šçŸ¥</span>
              </label>
              <div v-if="config.notificationConfig.enableLossNotification" class="sub-inputs">
                <div class="input-group">
                  <label>äºæŸæ¯”ä¾‹ (%)</label>
                  <input 
                    type="number" 
                    v-model.number="lossThresholdAbs" 
                    class="input-small"
                    step="0.1">
                </div>
                <div class="input-group">
                  <label>äºæŸé‡‘é¢ (USDT)</label>
                  <input 
                    type="number" 
                    v-model.number="lossAmountThresholdAbs" 
                    class="input-small"
                    step="0.1">
                </div>
              </div>
            </div>

            <div class="notification-item">
              <label class="checkbox-label">
                <input type="checkbox" v-model="config.notificationConfig.enableTimeNotification">
                <span>å®šæ—¶é€šçŸ¥</span>
              </label>
              <div v-if="config.notificationConfig.enableTimeNotification" class="sub-inputs">
                <div class="input-group">
                  <label>é—´éš” (åˆ†é’Ÿ)</label>
                  <input 
                    type="number" 
                    v-model.number="timeIntervalMinutes" 
                    class="input-small"
                    min="1">
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ä¿å­˜æŒ‰é’® -->
      <div class="save-section">
        <button @click="saveConfig" class="btn-save" :disabled="saving">
          {{ saving ? 'ä¿å­˜ä¸­...' : 'ğŸ’¾ ä¿å­˜é…ç½®' }}
        </button>
        <div v-if="saveMessage" class="save-message" :class="{ error: saveError }">
          {{ saveMessage }}
        </div>
      </div>
    </div>

    <!-- å¸‚åœºåˆ†æé¡µé¢ -->
    <div v-show="currentTab === 'analysis'" class="container">
      <section class="card">
        <div class="card-header">
          <h2>ğŸ“Š å¸‚åœºåˆ†æ</h2>
        </div>
        <div class="card-body">
          <div class="input-group">
            <label>é€‰æ‹©åˆçº¦</label>
            <select v-model="analysisSymbol" class="input">
              <option value="ETH-USDT">ETH-USDT</option>
              <option value="BTC-USDT">BTC-USDT</option>
              <option value="SOL-USDT">SOL-USDT</option>
              <option value="DOGE-USDT">DOGE-USDT</option>
              <option value="XRP-USDT">XRP-USDT</option>
            </select>
          </div>
          
          <button @click="loadAnalysis" class="btn-add" :disabled="analysisLoading">
            {{ analysisLoading ? 'åˆ†æä¸­...' : 'ğŸ” å¼€å§‹åˆ†æ' }}
          </button>
          
          <small class="input-hint" style="display: block; margin-top: 10px;">
            ğŸ’¡ è‡ªåŠ¨ä½¿ç”¨å®æ—¶ä»·æ ¼å’ŒæŒä»“æˆæœ¬è¿›è¡Œåˆ†æ
          </small>
        </div>
      </section>

      <!-- åˆ†æç»“æœ -->
      <section v-if="analysisReport" class="card">
        <div class="card-header">
          <h2>ğŸ¤– æ™ºèƒ½äº¤æ˜“å»ºè®®</h2>
        </div>
        <div class="card-body">
          <div v-if="analysisReport.suggestion" class="suggestion-box">
            <div class="suggestion-action" :class="analysisReport.suggestion.action">
              <div class="action-icon">
                {{ analysisReport.suggestion.action === 'long' ? 'ğŸŸ¢' : analysisReport.suggestion.action === 'short' ? 'ğŸ”´' : 'ğŸŸ¡' }}
              </div>
              <div class="action-text">
                <h3>{{ getActionText(analysisReport.suggestion.action) }}</h3>
                <p>ä¿¡å¿ƒæŒ‡æ•°: {{ analysisReport.suggestion.confidence }}%</p>
              </div>
            </div>
            
            <div class="confidence-bar">
              <div class="bar-fill" :style="{ width: analysisReport.suggestion.confidence + '%' }"></div>
            </div>
            
            <div class="signals">
              <div class="signal-item">
                <span>ğŸ“ˆ çœ‹æ¶¨ä¿¡å·</span>
                <strong>{{ analysisReport.suggestion.signals.bullish }} åˆ†</strong>
              </div>
              <div class="signal-item">
                <span>ğŸ“‰ çœ‹è·Œä¿¡å·</span>
                <strong>{{ analysisReport.suggestion.signals.bearish }} åˆ†</strong>
              </div>
            </div>
            
            <div class="reasons">
              <h4>åˆ†æä¾æ®ï¼š</h4>
              <ul>
                <li v-for="(reason, index) in analysisReport.suggestion.reasons" :key="index">
                  {{ reason }}
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- å¤šæ—¶é—´çª—å£åˆ†æ -->
      <section v-if="analysisReport && analysisReport.multiTimeframe" class="card">
        <div class="card-header">
          <h2>ğŸ“ˆ å¤šæ—¶é—´çª—å£åˆ†æ</h2>
        </div>
        <div class="card-body">
          <div class="timeframe-list">
            <div v-for="tf in analysisReport.multiTimeframe" :key="tf.timeframe" class="timeframe-item">
              <span class="tf-name">{{ tf.timeframe }}</span>
              <span class="tf-change" :class="{ positive: tf.changePercent > 0, negative: tf.changePercent < 0 }">
                {{ tf.changePercent >= 0 ? '+' : '' }}{{ tf.changePercent.toFixed(2) }}%
              </span>
              <span class="tf-emoji">{{ tf.trend === 'up' ? 'ğŸ“ˆ' : 'ğŸ“‰' }}</span>
            </div>
          </div>
        </div>
      </section>

      <!-- ä»·æ ¼åŒºé—´åˆ†æ -->
      <section v-if="analysisReport && analysisReport.priceRange" class="card">
        <div class="card-header">
          <h2>ğŸ“Š ä»·æ ¼åŒºé—´åˆ†æ</h2>
        </div>
        <div class="card-body">
          <div v-for="range in analysisReport.priceRange" :key="range.timeframe" class="range-item">
            <h4>{{ range.timeframe }}</h4>
            <div class="range-info">
              <div>æœ€é«˜: {{ range.highest.toFixed(2) }}</div>
              <div>æœ€ä½: {{ range.lowest.toFixed(2) }}</div>
              <div>æŒ¯å¹…: {{ range.amplitude.toFixed(2) }}%</div>
            </div>
            <div class="position-bar">
              <div class="position-fill" :style="{ left: range.position + '%' }"></div>
            </div>
            <div class="position-text">å½“å‰ä½ç½®: {{ range.position.toFixed(0) }}%</div>
          </div>
        </div>
      </section>
    </div>

    <!-- æ­¢ç›ˆæ­¢æŸè®¡ç®—å™¨é¡µé¢ -->
    <div v-show="currentTab === 'calculator'" class="container">
      <section class="card">
        <div class="card-header">
          <h2>ğŸ§® æ­¢ç›ˆæ­¢æŸè®¡ç®—å™¨</h2>
        </div>
        <div class="card-body">
          <!-- è¾“å…¥åŒºåŸŸ -->
          <div class="calculator-inputs">
            <div class="input-group">
              <label>äº¤æ˜“å¯¹</label>
              <select v-model="calculator.symbol" class="input">
                <option value="BTC-USDT">BTC-USDT</option>
                <option value="ETH-USDT">ETH-USDT</option>
                <option value="SOL-USDT">SOL-USDT</option>
                <option value="BNB-USDT">BNB-USDT</option>
                <option value="XRP-USDT">XRP-USDT</option>
              </select>
            </div>

            <div class="input-group">
              <label>å®æ—¶ä»·æ ¼</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input 
                  type="number" 
                  :value="getLivePrice(calculator.symbol)" 
                  readonly 
                  class="input" 
                  style="background: #f0f0f0; cursor: not-allowed;">
                <button @click="useCurrentPrice" class="btn-small btn-success">ä½¿ç”¨</button>
              </div>
              <small class="input-hint">{{ getPriceStatus(calculator.symbol) }}</small>
            </div>

            <div class="input-group">
              <label>å¼€ä»“æ–¹å‘</label>
              <div class="quick-tags">
                <button 
                  class="tag-btn" 
                  :class="{ 'long-active': calculator.direction === 'long' }"
                  @click="calculator.direction = 'long'"
                  style="flex: 1;">
                  ğŸ“ˆ åšå¤š
                </button>
                <button 
                  class="tag-btn" 
                  :class="{ 'short-active': calculator.direction === 'short' }"
                  @click="calculator.direction = 'short'"
                  style="flex: 1;">
                  ğŸ“‰ åšç©º
                </button>
              </div>
            </div>

            <div class="input-group">
              <label>å¼€ä»“ä»·æ ¼</label>
              <input 
                type="number" 
                v-model.number="calculator.entryPrice" 
                placeholder="ä¾‹å¦‚: 1900" 
                step="0.01"
                class="input">
              <small class="input-hint">USDT</small>
            </div>

            <div class="input-group">
              <label>ä¿è¯é‡‘</label>
              <input 
                type="number" 
                v-model.number="calculator.margin" 
                placeholder="ä¾‹å¦‚: 50" 
                step="0.01"
                class="input">
              <div class="quick-tags">
                <button class="tag-btn" @click="calculator.margin = 10">10</button>
                <button class="tag-btn" @click="calculator.margin = 50">50</button>
                <button class="tag-btn" @click="calculator.margin = 100">100</button>
                <button class="tag-btn" @click="calculator.margin = 200">200</button>
                <button class="tag-btn" @click="calculator.margin = 500">500</button>
              </div>
              <small class="input-hint">USDT</small>
            </div>

            <div class="input-group">
              <label>æ æ†å€æ•°</label>
              <input 
                type="number" 
                v-model.number="calculator.leverage" 
                readonly
                class="input"
                style="background: #f8f8f8;">
              <div class="quick-tags">
                <button class="tag-btn" @click="calculator.leverage = 1">1x</button>
                <button class="tag-btn" @click="calculator.leverage = 3">3x</button>
                <button class="tag-btn" @click="calculator.leverage = 5">5x</button>
                <button class="tag-btn" @click="calculator.leverage = 8">8x</button>
                <button class="tag-btn" @click="calculator.leverage = 10">10x</button>
                <button class="tag-btn" @click="calculator.leverage = 20">20x</button>
                <button class="tag-btn" @click="calculator.leverage = 50">50x</button>
              </div>
              <small class="input-hint">å€</small>
            </div>

            <div class="input-group">
              <label>æ­¢æŸæ¯”ä¾‹</label>
              <input 
                type="number" 
                v-model.number="calculator.stopLoss" 
                placeholder="ä¾‹å¦‚: 6" 
                step="0.1"
                class="input">
              <div class="quick-tags">
                <button class="tag-btn" @click="calculator.stopLoss = 2">2%</button>
                <button class="tag-btn" @click="calculator.stopLoss = 5">5%</button>
                <button class="tag-btn" @click="calculator.stopLoss = 6">6%</button>
                <button class="tag-btn" @click="calculator.stopLoss = 10">10%</button>
                <button class="tag-btn" @click="calculator.stopLoss = 15">15%</button>
                <button class="tag-btn" @click="calculator.stopLoss = 20">20%</button>
              </div>
              <small class="input-hint">% (æ”¶ç›Šç‡)</small>
            </div>

            <div class="input-group">
              <label>æ­¢ç›ˆæ¯”ä¾‹</label>
              <input 
                type="number" 
                v-model.number="calculator.takeProfit" 
                placeholder="ä¾‹å¦‚: 10" 
                step="0.1"
                class="input">
              <div class="quick-tags">
                <button class="tag-btn" @click="calculator.takeProfit = 5">5%</button>
                <button class="tag-btn" @click="calculator.takeProfit = 10">10%</button>
                <button class="tag-btn" @click="calculator.takeProfit = 15">15%</button>
                <button class="tag-btn" @click="calculator.takeProfit = 20">20%</button>
                <button class="tag-btn" @click="calculator.takeProfit = 30">30%</button>
                <button class="tag-btn" @click="calculator.takeProfit = 50">50%</button>
              </div>
              <small class="input-hint">% (æ”¶ç›Šç‡)</small>
            </div>
          </div>
        </div>
      </section>

      <!-- è®¡ç®—ç»“æœ -->
      <section v-if="calculatorResult" class="card">
        <div class="card-header">
          <h2>ğŸ“Š æŒä»“ä¿¡æ¯</h2>
        </div>
        <div class="card-body">
          <div class="result-grid">
            <div class="result-item">
              <span class="result-label">å¼€ä»“æ–¹å‘</span>
              <span class="result-value">{{ calculatorResult.direction === 'long' ? 'åšå¤š (ä¹°å…¥å¼€å¤š)' : 'åšç©º (å–å‡ºå¼€ç©º)' }}</span>
            </div>
            <div class="result-item">
              <span class="result-label">å¼€ä»“ä»·æ ¼</span>
              <span class="result-value">{{ calculatorResult.entryPrice.toFixed(2) }} USDT</span>
            </div>
            <div class="result-item">
              <span class="result-label">ä¿è¯é‡‘</span>
              <span class="result-value">{{ calculatorResult.margin.toFixed(2) }} USDT</span>
            </div>
            <div class="result-item">
              <span class="result-label">æ æ†å€æ•°</span>
              <span class="result-value">{{ calculatorResult.leverage }}x</span>
            </div>
            <div class="result-item">
              <span class="result-label">æŒä»“ä»·å€¼</span>
              <span class="result-value">{{ calculatorResult.positionValue.toFixed(2) }} USDT</span>
            </div>
            <div class="result-item">
              <span class="result-label">å¼€ä»“æ‰‹ç»­è´¹</span>
              <span class="result-value profit-negative">-{{ calculatorResult.totalFee.toFixed(4) }} USDT</span>
            </div>
          </div>
        </div>
      </section>
      
      <!-- å¦‚æœæ²¡æœ‰è®¡ç®—ç»“æœï¼Œæ˜¾ç¤ºæç¤º -->
      <section v-else class="card">
        <div class="card-header">
          <h2>ğŸ’¡ æç¤º</h2>
        </div>
        <div class="card-body">
          <div class="placeholder">
            <p>è¯·å¡«å†™å¼€ä»“ä»·æ ¼å’Œä¿è¯é‡‘å¼€å§‹è®¡ç®—</p>
            <p style="font-size: 14px; color: #999;">å½“å‰è¾“å…¥ï¼šä»·æ ¼={{ calculator.entryPrice }}, ä¿è¯é‡‘={{ calculator.margin }}</p>
          </div>
        </div>
      </section>

      <!-- æ­¢æŸä¿¡æ¯ -->
      <section v-if="calculatorResult" class="card">
        <div class="card-header">
          <h2>ğŸ›‘ æ­¢æŸç‚¹ä½ <span style="color: #ef4444; font-size: 14px;">(æ”¶ç›Šç‡: -{{ calculator.stopLoss }}%)</span></h2>
        </div>
        <div class="card-body">
          <div class="result-grid">
            <div class="result-item">
              <span class="result-label">æ­¢æŸä»·æ ¼</span>
              <span class="result-value profit-negative copyable" @click="copyPrice(calculatorResult.stopLossPrice)" title="ç‚¹å‡»å¤åˆ¶">
                {{ calculatorResult.stopLossPrice.toFixed(2) }} USDT
                <span class="copy-icon">ğŸ“‹</span>
              </span>
            </div>
            <div class="result-item">
              <span class="result-label">ä»·æ ¼å˜åŒ–</span>
              <span class="result-value">{{ calculatorResult.stopLossPriceChange.toFixed(2) }}%</span>
            </div>
            <div class="result-item">
              <span class="result-label">äºæŸé‡‘é¢</span>
              <span class="result-value profit-negative">{{ calculatorResult.stopLossAmount.toFixed(2) }} USDT</span>
            </div>
            <div class="result-item">
              <span class="result-label">å‰©ä½™èµ„é‡‘</span>
              <span class="result-value">{{ calculatorResult.stopLossRemaining.toFixed(2) }} USDT</span>
            </div>
          </div>
        </div>
      </section>

      <!-- æ­¢ç›ˆä¿¡æ¯ -->
      <section v-if="calculatorResult" class="card">
        <div class="card-header">
          <h2>ğŸ¯ æ­¢ç›ˆç‚¹ä½ <span style="color: #10b981; font-size: 14px;">(æ”¶ç›Šç‡: +{{ calculator.takeProfit }}%)</span></h2>
        </div>
        <div class="card-body">
          <div class="result-grid">
            <div class="result-item">
              <span class="result-label">æ­¢ç›ˆä»·æ ¼</span>
              <span class="result-value profit-positive copyable" @click="copyPrice(calculatorResult.takeProfitPrice)" title="ç‚¹å‡»å¤åˆ¶">
                {{ calculatorResult.takeProfitPrice.toFixed(2) }} USDT
                <span class="copy-icon">ğŸ“‹</span>
              </span>
            </div>
            <div class="result-item">
              <span class="result-label">ä»·æ ¼å˜åŒ–</span>
              <span class="result-value">+{{ calculatorResult.takeProfitPriceChange.toFixed(2) }}%</span>
            </div>
            <div class="result-item">
              <span class="result-label">ç›ˆåˆ©é‡‘é¢</span>
              <span class="result-value profit-positive">+{{ calculatorResult.takeProfitAmount.toFixed(2) }} USDT</span>
            </div>
            <div class="result-item">
              <span class="result-label">æ€»èµ„é‡‘</span>
              <span class="result-value">{{ calculatorResult.takeProfitTotal.toFixed(2) }} USDT</span>
            </div>
          </div>
        </div>
      </section>

      <!-- ä»·æ ¼æ¢¯åº¦è¡¨ -->
      <section v-if="calculatorResult && calculatorResult.priceTable" class="card">
        <div class="card-header">
          <h2>ğŸ“ˆ ä»·æ ¼æ¢¯åº¦ç›ˆäºè¡¨</h2>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="price-table">
              <thead>
                <tr>
                  <th>ä»·æ ¼å˜åŒ–</th>
                  <th>ç›®æ ‡ä»·æ ¼</th>
                  <th>æ”¶ç›Šç‡</th>
                  <th>ç›ˆäºé‡‘é¢</th>
                  <th>æ€»èµ„é‡‘</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(row, index) in calculatorResult.priceTable" :key="index">
                  <td>{{ row.priceChange }}</td>
                  <td>{{ row.targetPrice.toFixed(2) }} USDT</td>
                  <td :class="row.profitPercent >= 0 ? 'profit-positive' : 'profit-negative'">
                    {{ row.profitPercent >= 0 ? '+' : '' }}{{ row.profitPercent.toFixed(2) }}%
                  </td>
                  <td :class="row.profitAmount >= 0 ? 'profit-positive' : 'profit-negative'" style="font-weight: 600;">
                    {{ row.profitAmount >= 0 ? '+' : '' }}{{ row.profitAmount.toFixed(2) }} USDT
                  </td>
                  <td style="font-weight: 600;">{{ row.totalBalance.toFixed(2) }} USDT</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- è¯´æ˜ -->
      <section class="card">
        <div class="card-header">
          <h2>ğŸ’¡ è®¡ç®—è¯´æ˜</h2>
        </div>
        <div class="card-body">
          <div class="info-box">
            <p>
              â€¢ æ”¶ç›Šç‡ = ä»·æ ¼å˜åŒ–% Ã— æ æ†å€æ•°<br>
              â€¢ ç›ˆäºé‡‘é¢ = ä¿è¯é‡‘ Ã— æ”¶ç›Šç‡ - æ‰‹ç»­è´¹<br>
              â€¢ æ‰‹ç»­è´¹ = ä¿è¯é‡‘ Ã— 0.05% Ã— 2ï¼ˆå¼€ä»“ + å¹³ä»“ï¼‰<br>
              â€¢ æ­¢æŸ/æ­¢ç›ˆä»·æ ¼æ ¹æ®æ”¶ç›Šç‡åæ¨è®¡ç®—<br>
              â€¢ å®é™…äº¤æ˜“ä¸­å¯èƒ½å­˜åœ¨æ»‘ç‚¹ï¼Œå»ºè®®é¢„ç•™ä¸€å®šç©ºé—´
            </p>
          </div>
        </div>
      </section>
    </div>

    <!-- æ•°æ®å±•ç¤ºé¡µé¢ -->
    <div v-show="currentTab === 'data'" class="container">
      
      <!-- é‡åŒ–äº¤æ˜“çŠ¶æ€ -->
      <section v-if="realtimeData.quant" class="card">
        <div class="card-header">
          <h2>ğŸ¤– é‡åŒ–äº¤æ˜“</h2>
          <span class="status-badge" :class="realtimeData.quant.enabled ? 'status-active' : 'status-inactive'">
            {{ realtimeData.quant.enabled ? 'âœ… è¿è¡Œä¸­' : 'âŒ å·²å…³é—­' }}
          </span>
        </div>
        
        <div v-if="realtimeData.quant.enabled" class="card-body">
          <!-- åŸºæœ¬ä¿¡æ¯ -->
          <div class="quant-info">
            <div class="info-item">
              <span class="label">æ¨¡å¼</span>
              <span class="value">{{ realtimeData.quant.testMode ? 'ğŸ§ª æµ‹è¯•æ¨¡å¼' : 'ğŸ’° å®ç›˜æ¨¡å¼' }}</span>
            </div>
            <div class="info-item">
              <span class="label">äº¤æ˜“å¯¹</span>
              <span class="value">{{ realtimeData.quant.symbol }}</span>
            </div>
            <div class="info-item">
              <span class="label">è´¦æˆ·ä½™é¢</span>
              <span class="value balance">{{ realtimeData.quant.balance?.toFixed(2) || '0.00' }} USDT</span>
            </div>
            <div class="info-item">
              <span class="label">å½“å‰ä»·æ ¼</span>
              <span class="value price">{{ realtimeData.quant.lastPrice?.toFixed(2) || '0.00' }} USDT</span>
            </div>
          </div>

          <!-- æŒä»“åˆ—è¡¨ -->
          <div v-if="realtimeData.quant.positions && realtimeData.quant.positions.length > 0" class="positions-section">
            <h3>ğŸ“Š å½“å‰æŒä»“ ({{ realtimeData.quant.positions.length }})</h3>
            <div v-for="(pos, index) in realtimeData.quant.positions" :key="index" class="position-card">
              <div class="position-header">
                <span class="position-direction" :class="pos.direction">
                  {{ pos.direction === 'long' ? 'ğŸ“ˆ åšå¤š' : 'ğŸ“‰ åšç©º' }}
                </span>
                <span class="position-profit" :class="pos.profitUSDT >= 0 ? 'profit-positive' : 'profit-negative'">
                  {{ pos.profitUSDT >= 0 ? '+' : '' }}{{ pos.profitUSDT?.toFixed(2) || '0.00' }} USDT
                </span>
              </div>
              <div class="position-details">
                <div class="detail-row">
                  <span>å¼€ä»“ä»·</span>
                  <span>{{ pos.entryPrice?.toFixed(2) || '0.00' }} USDT</span>
                </div>
                <div class="detail-row">
                  <span>ä¿è¯é‡‘</span>
                  <span>{{ pos.value?.toFixed(2) || '0.00' }} USDT</span>
                </div>
                <div class="detail-row">
                  <span>æ”¶ç›Šç‡ (ROE)</span>
                  <span :class="pos.roe >= 0 ? 'profit-positive' : 'profit-negative'">
                    {{ pos.roe >= 0 ? '+' : '' }}{{ pos.roe?.toFixed(2) || '0.00' }}%
                  </span>
                </div>
                <div class="detail-row">
                  <span>ä»·æ ¼æ¶¨è·Œ</span>
                  <span :class="pos.profitPercent >= 0 ? 'profit-positive' : 'profit-negative'">
                    {{ pos.profitPercent >= 0 ? '+' : '' }}{{ pos.profitPercent?.toFixed(2) || '0.00' }}%
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div v-else class="no-positions">
            <p>ğŸ“­ æš‚æ— æŒä»“</p>
          </div>

          <!-- ç»Ÿè®¡æ•°æ® -->
          <div v-if="realtimeData.quant.stats" class="stats-section">
            <h3>ğŸ“ˆ äº¤æ˜“ç»Ÿè®¡</h3>
            <div class="stats-grid">
              <div class="stat-item">
                <span class="stat-label">æ€»äº¤æ˜“</span>
                <span class="stat-value">{{ realtimeData.quant.stats.totalTrades || 0 }}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">ç›ˆåˆ©æ¬¡æ•°</span>
                <span class="stat-value profit-positive">{{ realtimeData.quant.stats.winTrades || 0 }}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">äºæŸæ¬¡æ•°</span>
                <span class="stat-value profit-negative">{{ realtimeData.quant.stats.lossTrades || 0 }}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">èƒœç‡</span>
                <span class="stat-value">
                  {{ realtimeData.quant.stats.totalTrades > 0 
                    ? ((realtimeData.quant.stats.winTrades / realtimeData.quant.stats.totalTrades) * 100).toFixed(2) 
                    : '0.00' }}%
                </span>
              </div>
              <div class="stat-item">
                <span class="stat-label">æ€»ç›ˆäº</span>
                <span class="stat-value" :class="realtimeData.quant.stats.totalProfit >= 0 ? 'profit-positive' : 'profit-negative'">
                  {{ realtimeData.quant.stats.totalProfit >= 0 ? '+' : '' }}{{ realtimeData.quant.stats.totalProfit?.toFixed(2) || '0.00' }} USDT
                </span>
              </div>
              <div class="stat-item">
                <span class="stat-label">æœ€å¤§å›æ’¤</span>
                <span class="stat-value">{{ ((realtimeData.quant.stats.maxDrawdown || 0) * 100).toFixed(2) }}%</span>
              </div>
            </div>
          </div>
        </div>
        
        <div v-else class="card-body">
          <div class="placeholder">
            <p>ğŸ’¡ é‡åŒ–äº¤æ˜“æœªå¯ç”¨</p>
            <p>åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½® <code>QUANT_ENABLED=true</code> å¯ç”¨</p>
          </div>
        </div>
      </section>

      <!-- å®æ—¶ä»·æ ¼ -->
      <section class="card">
        <div class="card-header">
          <h2>ğŸ’µ å®æ—¶ä»·æ ¼</h2>
          <span class="update-time">{{ formatTime(realtimeData.timestamp) }}</span>
        </div>
        <div class="card-body">
          <div v-if="Object.keys(realtimeData.prices || {}).length > 0" class="prices-grid">
            <div v-for="(priceData, symbol) in realtimeData.prices" :key="symbol" class="price-card">
              <div class="price-symbol">{{ symbol }}</div>
              <div class="price-value">{{ priceData.price?.toFixed(2) || '0.00' }} USDT</div>
              <div class="price-time">{{ formatTime(priceData.timestamp) }}</div>
            </div>
          </div>
          <div v-else class="placeholder">
            <p>ğŸ“­ æš‚æ— ä»·æ ¼æ•°æ®</p>
            <p>è¯·å…ˆå¯åŠ¨ç›‘æ§ç¨‹åº</p>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
